<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>windscape • windscape</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="windscape">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">windscape</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/windscape.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>windscape</h1>
            
      

      <div class="d-none name"><code>windscape.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="contents">Contents<a class="anchor" aria-label="anchor" href="#contents"></a>
</h2>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#importing-wind-data">Importing wind data</a></li>
<li><a href="#constructing-a-connectivity-graph">Constructing a
connectivity graph</a></li>
<li><a href="#estimating-wind-connectivity">Estimating wind
connectivity</a></li>
<li><a href="#testing-statistical-relationships">Testing statistical
relationships</a></li>
</ul>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>windscape</code> package was designed to help users analyze
the role of wind geography in spatial ecology. Wind strength and
direction vary over space and time, influencing the transport dynamics
of airborne particles like spores, pollen, seeds, and insects, and in
turn shaping emergent biodiversity patterns such as landscape genetics,
community composition, and species distributions.</p>
<p>The functions in <code>windscape</code> help you to download hourly
wind rasters, convert them into a landscape connectivity graph, use the
graph to estimate directional wind flows among sites of interest, and
test the statistical relationships between these flows and your own
ecological data. Each of these four steps is detailed in its own section
below.</p>
<p>This package differs from other wind connectivity modeling frameworks
like <code>rWind</code> in that it focuses not on a snapshot of wind
conditions but on connectivity over longer time periods, integrating
over many shorter, step-wise dispersal events that occur over time.</p>
<p>To get started, let’s load the <code>windscape</code> package, as
well as <code>tidyverse</code> for its general utility:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://matthewkling.github.io/windscape/">windscape</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="importing-wind-data">Importing wind data<a class="anchor" aria-label="anchor" href="#importing-wind-data"></a>
</h2>
<p>The input data for a windscape analysis is a time series of wind
fields. A single wind field is a pair of raster layers, with values in
each grid cell representing the <code>u</code> and <code>v</code>
components of the local wind vector at one point in time. Because the
modeling approach is designed to capture temporal variability in wind
conditions, high-frequency time series data should be used; summaries
like monthly, annual, or multi-year mean wind fields will probably give
poor results. “Reanalysis” data sets, such as the CFSR, ERA5, and NARR,
are great data sources as they comprise decades of
<strong>hourly</strong> gridded wind data that give excellent
representations of wind variability over space and time.</p>
<p>Depending on the study system, one might wish to model wind
connectivity using a relatively short time frame of a few days or weeks,
or to integrate over decades of wind conditions to more fully capture
the variability of wind dynamics that shape ecological patterns over
longer time frames. Users might also want to filter their input wind
data by season, time of day, or temperature, in order to isolate wind
conditions when their study species is likely to be airborne.
<code>windscape</code> models are built using data for a single
atmospheric layer, and vertical transport is not considered. In this
vignette we’ll use data on near-surface (10 m) winds, but
higher-altitude wind data could also be used.</p>
<p>Wind data can be downloaded from within R, or can be obtained
separately and loaded into R. Let’s see an example of both
approaches.</p>
<p>The function <code><a href="../reference/cfsr_dl.html">cfsr_dl()</a></code> downloads hourly wind data from
the Climate Forecast System Reanalysis (CFSR). In the code below, we’ll
import 10-m-level data for a chunk of North America for a sparse series
of days distributed across a single summer. A real analysis would likely
want a denser and/or longer time series. This example runs in a few
minutes, but it could take hours or longer to download a more complete
dataset. (Note that because this region is in the western hemisphere and
CFSR uses longitudes in the 0-360 range, some shifty business is
needed.)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wind</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cfsr_dl.html">cfsr_dl</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="st">"wnd10m"</span>, years <span class="op">=</span> <span class="fl">2000</span>, months <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">9</span>, days <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">28</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>                xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">120</span>, <span class="op">-</span><span class="fl">90</span><span class="op">)</span> <span class="op">+</span> <span class="fl">360</span>, <span class="co"># shift longitudes to be in [0, 360] range for CFSR</span></span>
<span>                ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rspatial.github.io/terra/reference/shift.html" class="external-link">shift</a></span><span class="op">(</span>dx <span class="op">=</span> <span class="op">-</span><span class="fl">360</span><span class="op">)</span> <span class="co"># shift longitude back to the standard [-180, 180] range</span></span></code></pre></div>
<p>Alternatively we can load wind data locally from disk (a more likely
scenario for an actual analysis), using <code><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">terra::rast()</a></code>. The
data set loaded below, which ships with the <code>windscape</code>
package, is the same one downloaded by the example code above. We can
see it’s a <code>SpatRaster</code> object with many layers, each a ‘u’
(east-west) or ‘v’ (north-south) component of the local wind vector for
a particular date and time.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/wind.tif"</span>, package <span class="op">=</span> <span class="st">"windscape"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">wind</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 64, 96, 1152  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 0.3157895, 0.3174603  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -120.1579, -89.84211, 29.84127, 50.15873  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 </span></span>
<span><span class="co">#&gt; source      : wind.tif </span></span>
<span><span class="co">#&gt; names       : u 2000-01-01, u 200~00:00, u 200~00:00, u 200~00:00, u 200~00:00, u 200~00:00, ... </span></span>
<span><span class="co">#&gt; min values  :        -4.80,       -4.68,       -4.02,       -3.96,       -4.15,       -4.54, ... </span></span>
<span><span class="co">#&gt; max values  :         7.84,        7.63,        9.20,        9.77,       10.05,       10.17, ...</span></span></code></pre></div>
<p>Next we’ll convert these data into a formal <code>wind_field</code>
object, which is a <code>SpatRaster</code> of wind data meeting certain
criteria. To do this, we need to tell it that our <code>wind</code>
dataset has <code>order = "uuvv"</code>, meaning all the u components
come first, followed by all the v components; other data sets might have
<code>order = "uvuv"</code>. (It’s assumed that the order of the u’s is
the same as the v’s, so we need to be confident of this based on
knowledge of our data.) The <code><a href="../reference/wind_field.html">wind_field()</a></code> function creates a
wind field object:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">field</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wind_field.html">wind_field</a></span><span class="op">(</span><span class="va">wind</span>, order <span class="op">=</span> <span class="st">"uuvv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="constructing-a-connectivity-graph">Constructing a connectivity graph<a class="anchor" aria-label="anchor" href="#constructing-a-connectivity-graph"></a>
</h2>
<p>In order to estimate wind flows among sites of interest, we need to
first convert our big wind field time series into a directed
connectivity graph representing the average wind flow between each grid
cell and each of its eight “queen” neighbors. The steps in this process
include summarizing the time series into a <code>wind_rose</code> raster
object, optionally modifying the wind rose to incorporate non-wind
factors influencing dispersal, and/or to increase its spatial
resolution, and then converting this into a <code>wind_graph</code>
transition object.</p>
<div class="section level3">
<h3 id="creating-a-wind-rose">1: Creating a wind rose<a class="anchor" aria-label="anchor" href="#creating-a-wind-rose"></a>
</h3>
<p>A <code>wind_rose</code> object, constructed with the
<code><a href="../reference/wind_rose.html">wind_rose()</a></code> function, is a raster data set with eight
layers, each of which represents long-term wind conductance in the
direction of a neighboring cell. These conductance values are a function
of the input data on wind speed and direction, adjusted for the
curvature of the earth, distances to neighboring cells, and potential
differences between x and y raster resolutions.</p>
<p>The main decision when creating a wind rose is the <code>trans</code>
argument, which defines the transformation that turns wind speed into
conductance strength. The default is <code>trans = 1</code>, which makes
conductance proportional to wind speed – but alternatively, conductance
can be made proportional to aerodynamic drag (speed^2) or to wind force
(speed^3), can account for threshold speeds above which seed abscission
is likely to occur, or can ignore speed entirely and consider only
direction; see <code><a href="../reference/wind_rose.html">?wind_rose</a></code> for details.</p>
<p>After a local wind vector for a particular time step is transformed
from speed to conductance, this conductance is allocated between a
cardinal and semi-cardinal neighbor, in proportion to the angle and
distance between the downwind direction and the directions of the two
adjacent downwind neighbors. Conductance values are calculated for each
individual time step in the wind field data set, and then averaged to
produce the final wind rose object. If input speeds are in m/s and
<code>trans = 1</code>, then the wind rose conductance values are in
units of 1/hours.</p>
<p>Let’s covert our <code>wind_field</code> into a
<code>wind_rose</code> here. Plotting it, we see that is has 8 layers,
one for wind connectivity in each semi-cardinal direction.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rose</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wind_rose.html">wind_rose</a></span><span class="op">(</span><span class="va">field</span>, trans <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rose</span><span class="op">)</span></span></code></pre></div>
<p><img src="windscape_files/figure-html/rose-1.png" width="95%"></p>
</div>
<div class="section level3">
<h3 id="incorporationg-non-wind-dispersal-barriers-optional">2: Incorporationg non-wind dispersal barriers (optional)<a class="anchor" aria-label="anchor" href="#incorporationg-non-wind-dispersal-barriers-optional"></a>
</h3>
<p>In some cases, you may want to account for factors other than wind
that influence connectivity across a landscape, by down-weighting
conductance over cells that contain water, inhospitable terrain, or
other dispersal barriers. To incorporate factors like this, we can use
the <code><a href="../reference/weight_conductance.html">weight_conductance()</a></code> function to scale the values in
our <code>wind_rose</code>. Weights are supplied as a raster layer with
values between 0 and 1.</p>
<p>As an example, let’s downweight conductance by 90% in grid cells with
open water. Large water bodies could reduce landscape genetic
connectivity for wind-dispersed terrestrial organisms, since water can’t
support the intermediate populations that help facilitate long-term gene
flow across a landscape. In the example below, we’ll use the
<code><a href="../reference/cfsr_dl_land.html">cfsr_dl_land()</a></code> function to download a land-water raster
layer corresponding to our CFSR wind data set, <code><a href="https://rspatial.github.io/terra/reference/classify.html" class="external-link">classify()</a></code>
its values to convert 0’s (water) to 0.1 while leaving 1’s (land) as is,
and then use this weights layer to adjust our wind rose. Plotting the
first layer of the modified wind rose, we can see ocean and lake areas
in the southwest and northeast corners where conductance has been
reduced:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cfsr_dl_land.html">cfsr_dl_land</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">120</span>, <span class="op">-</span><span class="fl">90</span><span class="op">)</span> <span class="op">+</span> <span class="fl">360</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/shift.html" class="external-link">shift</a></span><span class="op">(</span>dx <span class="op">=</span> <span class="op">-</span><span class="fl">360</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rspatial.github.io/terra/reference/classify.html" class="external-link">classify</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.1</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co"># change all 0's to 0.1</span></span>
<span><span class="va">rose</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/weight_conductance.html">weight_conductance</a></span><span class="op">(</span><span class="va">rose</span>, <span class="va">weights</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rose</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="windscape_files/figure-html/weight-1.png" width="95%"></p>
</div>
<div class="section level3">
<h3 id="adjusting-spatial-resolution">3: Adjusting spatial resolution<a class="anchor" aria-label="anchor" href="#adjusting-spatial-resolution"></a>
</h3>
<p>Next, we have to consider how the spatial resolution of our wind data
relates to the distances among our study sites. The CFSR data we’re
using in this example, like many comparable data sets, has a grid cell
size of around ~30 km. This resolution will work well for estimating
wind conductance among distant sites, but since windscape models
estimate connectivity among the centers of the grid cells where sites
occur (regardless of where in the cell the a site is located), estimates
will be very noisy for sites separated by only a few cells, and will be
impossible for sites in the same cell. We can check whether this is a
problem using the <code><a href="../reference/check_cell_distance.html">check_cell_distance()</a></code> function.</p>
<p>If it is a problem, we can address it by increasing the resolution of
our data set using the <code><a href="../reference/downscale.html">downscale()</a></code> function, which
interpolates wind conductance data and adjusts the values to maintain
the correct connectivity units. (Note that the
<code>wind_cost_distance()</code> function, discussed below, can also
make its own internal adjustments for cell-distance discrepancies, so
downscaling is not the only solution.) Note that this downscaling
process does not add more information; it just “smooths” the wind
values. It fixes artifacts of the coarse resolution, but it does not
account for any real fine-scale variation in wind dynamics that actually
occurs within a grid cell due to factors like local terrain.</p>
<p>Importantly, while downscaling increases accuracy for nearby sites,
it comes at a computational cost. Downscaling a wind rose by a factor of
10 will increase its size 100-fold, increasing memory usage and
dramatically increasing processing time for the connectivity
calculations discussed below. For many analyses, a compromise resolution
can be used that balances accuracy and computational tractability. When
this isn’t possible, the <code><a href="../reference/vrcd.html">vrcd()</a></code> function can be used to
circumvent the trade-off; see the documentation for that function for
more details.</p>
<p>As an example, let’s imagine we have a set of ten study sites. Here
we’ll randomly generate spatial coordinates for their locations. Then
we’ll check how our wind rose resolution will work for these sites:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span>, <span class="op">-</span><span class="fl">115</span>, <span class="op">-</span><span class="fl">95</span><span class="op">)</span>,</span>
<span>               y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">33</span>, <span class="fl">47</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/check_cell_distance.html">check_cell_distance</a></span><span class="op">(</span><span class="va">rose</span>, <span class="va">sites</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: geosphere</span></span>
<span><span class="co">#&gt; Total point pairs: 45</span></span>
<span><span class="co">#&gt; Point pairs in the same grid cell: 0 (0%)</span></span>
<span><span class="co">#&gt; Distribution of cell-point distance discrepancies:</span></span>
<span><span class="co">#&gt;  0--1%: 21 (46.7%)</span></span>
<span><span class="co">#&gt;  1--2.5%: 15 (33.3%)</span></span>
<span><span class="co">#&gt;  2.5--5%: 8 (17.8%)</span></span>
<span><span class="co">#&gt;  5--10%: 1 (2.22%)</span></span>
<span><span class="co">#&gt;  10--25%: 0 (0%)</span></span>
<span><span class="co">#&gt;  25--Inf%: 0 (0%)</span></span></code></pre></div>
<p>It looks like we have no site pairs in the same grid cell, which is
great. But we do have one site pair with a distance error of 5-10%, and
another 23 pairs with errors of 1-5%. These aren’t huge errors but
they’ll add some noise to our wind estimates. Let’s downscale our wind
rose by a factor of 5, and then re-check our distance error rates:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rose</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/downscale.html">downscale</a></span><span class="op">(</span><span class="va">rose</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/check_cell_distance.html">check_cell_distance</a></span><span class="op">(</span><span class="va">rose</span>, <span class="va">sites</span><span class="op">)</span></span>
<span><span class="co">#&gt; Total point pairs: 45</span></span>
<span><span class="co">#&gt; Point pairs in the same grid cell: 0 (0%)</span></span>
<span><span class="co">#&gt; Distribution of cell-point distance discrepancies:</span></span>
<span><span class="co">#&gt;  0--1%: 43 (95.6%)</span></span>
<span><span class="co">#&gt;  1--2.5%: 2 (4.44%)</span></span>
<span><span class="co">#&gt;  2.5--5%: 0 (0%)</span></span>
<span><span class="co">#&gt;  5--10%: 0 (0%)</span></span>
<span><span class="co">#&gt;  10--25%: 0 (0%)</span></span>
<span><span class="co">#&gt;  25--Inf%: 0 (0%)</span></span></code></pre></div>
<p>After downscaling, 96% of our site pairs now have distance
discrepancies of less than 1%, and the other 4% all have discrepancies
of less than 2.5% – probably an acceptable margin of error given all the
other sources of uncertainty in a modeling analysis, and given the
additional corrections used in <code><a href="../reference/least_cost_distance.html">least_cost_distance()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="building-a-wind-graph">4: Building a wind graph<a class="anchor" aria-label="anchor" href="#building-a-wind-graph"></a>
</h3>
<p>Next we need to create a <code>wind_graph</code> object using the
<code><a href="../reference/wind_graph.html">wind_graph()</a></code> function. Technically, a wind graph is a
<code>transitionLayer</code> as defined in the <code>gdistance</code>
package.</p>
<p>The only decision here is whether we want a <code>downwind</code> or
<code>upwind</code> connectivity model. These are inversions of the same
idea: the outbound (downwind) conductance from site A to site B is the
same thing as the inbound (upwind) conductance arriving to site B from
site A. The decision is not critical if the goal is to analyze flows
among a set of sites, but if the goal is to create maps of the entire
wind accessibility landscape for a single site, then the difference is
more material. We’ll create a graph of each type here:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">downwind</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wind_graph.html">wind_graph</a></span><span class="op">(</span><span class="va">rose</span>, direction <span class="op">=</span> <span class="st">"downwind"</span><span class="op">)</span></span>
<span><span class="va">upwind</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wind_graph.html">wind_graph</a></span><span class="op">(</span><span class="va">rose</span>, direction <span class="op">=</span> <span class="st">"upwind"</span><span class="op">)</span></span>
<span><span class="va">upwind</span></span>
<span><span class="co">#&gt; class      : wind_graph </span></span>
<span><span class="co">#&gt; dimensions : 320, 480, 153600  (nrow, ncol, ncell)</span></span>
<span><span class="co">#&gt; resolution : 0.06315789, 0.06349206  (x, y)</span></span>
<span><span class="co">#&gt; extent     : -120.1579, -89.84211, 29.84127, 50.15873  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span></span>
<span><span class="co">#&gt; values      : resistance </span></span>
<span><span class="co">#&gt; matrix class: dgCMatrix</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="estimating-wind-connectivity">Estimating wind connectivity<a class="anchor" aria-label="anchor" href="#estimating-wind-connectivity"></a>
</h2>
<p>The <code>wind_graph</code> we created above is our final wind
connectivity model, and we can use it in various ways to estimate rates
of wind transport among sites. This package supports two algorithms for
calculating wind flows between sites: “least cost path” (LCP) and
“random walk” (RW). Note that because wind inherently involves
directional flow, wind connectivity has to be represented by a “directed
cyclic” graph, which makes it impossible to use circuit theory-based
algorithms that are commonly used in other landscape connectivity
applications.</p>
<p>The LCP algorithm finds the fastest wind travel route across a
landscape, based on the local connectivity between each cell and its
neighbors. It is computationally efficient, and it represents the speed
at which the first air particles would arrive at site after diffusing
across the landscape from a given origin location, given certain
assumptions.</p>
<p>The RW method instead runs a stepwise simulation. It is
computationally much slower, but it captures the full distribution of
particles diffusing in different directions rather than simply the speed
of the first, fastest particle to reach a site.</p>
<div class="section level3">
<h3 id="least-cost-path">Least cost path<a class="anchor" aria-label="anchor" href="#least-cost-path"></a>
</h3>
<p>Wind LCP calculations are handled through the
<code><a href="../reference/least_cost_surface.html">least_cost_surface()</a></code> and <code><a href="../reference/least_cost_distance.html">least_cost_distance()</a></code>
functions. Both functions calculate the same metric but for different
data structures. For wind models constructed with
<code>trans = 1</code>, they produce results in units of travel time
between grid cells; otherwise they give relative measures with less
interpretable units.</p>
<p><code><a href="../reference/least_cost_surface.html">least_cost_surface()</a></code> calculates the least cost distance
between a set of user-defined sites (one or more point locations) and
every grid cell across the region, producing a wall-to-wall raster of
wind cost-distance; if an <code>upwind</code> model is used then the
output represents travel times from a given grid cell to the focal site,
whereas a <code>downwind</code> model will calculate travel times from
the focal site to cells across the landscape. Here we’ll calculate both
variants, and make maps of them:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">site</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">105</span>, <span class="fl">40</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">downwind_hrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/least_cost_surface.html">least_cost_surface</a></span><span class="op">(</span><span class="va">downwind</span>, <span class="va">site</span><span class="op">)</span></span>
<span><span class="va">upwind_hrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/least_cost_surface.html">least_cost_surface</a></span><span class="op">(</span><span class="va">upwind</span>, <span class="va">site</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># restructure data and plot</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">downwind_hrs</span>, <span class="va">upwind_hrs</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"downwind"</span>, <span class="st">"upwind"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span>xy <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="va">direction</span>, <span class="va">wind_hours</span>, <span class="op">-</span><span class="va">x</span>, <span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">direction</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, fill <span class="op">=</span> <span class="va">wind_hours</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html" class="external-link">geom_contour</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, z <span class="op">=</span> <span class="va">wind_hours</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">20</span>, color <span class="op">=</span> <span class="st">"white"</span>, linewidth <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">site</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">V1</span>, <span class="va">V2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yellow"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>            strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="windscape_files/figure-html/accCost-1.png" width="95%"></p>
<p>In contrast, <code><a href="../reference/least_cost_distance.html">least_cost_distance()</a></code> calculates wind
travel times between every pair of sites in a user-specified set of
locations. It returns an asymmetric matrix in which element [i,j]
represents the cost-distance from the i’th to j’th site. Here we’ll
calculate cost-distances among the 10 sites we defined above. These
values represent hours of travel time, but if we had specified the
argument <code>rate = TRUE</code>, they would represent would represent
the inverse, wind flow rates per hour:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wind_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/least_cost_distance.html">least_cost_distance</a></span><span class="op">(</span><span class="va">downwind</span>, <span class="va">sites</span><span class="op">)</span></span>
<span><span class="va">wind_time</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;           [,1]       [,2]     [,3]     [,4]      [,5]</span></span>
<span><span class="co">#&gt; [1,]       NaN   84.49788 402.9980 469.0898  717.1286</span></span>
<span><span class="co">#&gt; [2,]  315.0642        NaN 381.4348 384.5526  808.0699</span></span>
<span><span class="co">#&gt; [3,] 1099.7984  858.79371      NaN 422.9502  860.2448</span></span>
<span><span class="co">#&gt; [4,] 1333.2703 1082.61184 415.3782      NaN 1144.4553</span></span>
<span><span class="co">#&gt; [5,]  892.6488  921.87234 172.9208 591.5632       NaN</span></span></code></pre></div>
<p>As discussed later in this document, these results can be used in
downstream analyses, such as comparing them to ecological data from the
same set of sites to assess the role of wind in structuring spatial
biodiversity patterns.</p>
</div>
<div class="section level3">
<h3 id="random-walk">Random walk<a class="anchor" aria-label="anchor" href="#random-walk"></a>
</h3>
<p>RW is implemented via the windscape function
<code><a href="../reference/random_walk.html">random_walk()</a></code>. It involves an iterative computation, with
“particle mass” diffusing from cells to their neighbors at each
iteration, in proportion to local directional wind conductance.</p>
<p>To run a random walk simulation, we need to specify the initial
conditions (the starting distribution of the particle mass), the number
of iterations, and the simulation mode. As an example, let’s start with
one unit of particle mass in a single central site and run a random walk
for 900 iterations, recording the distribution of particle mass every
100 iterations. We’ll use the default <code>mode = "pulse"</code>, which
models the fleeting diffusion of the particle mass that is initially
present. Plotting the result (with a red marker at the starting
location), we see the cloud of particle mass drifting and spreading as
the walk proceeds:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a cropped, non-downscaled wind rose so that example runs quickly</span></span>
<span><span class="va">rose</span> <span class="op">&lt;-</span> <span class="va">field</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/wind_rose.html">wind_rose</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run the RW computation</span></span>
<span><span class="va">walk</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/random_walk.html">random_walk</a></span><span class="op">(</span><span class="va">rose</span>, init <span class="op">=</span> <span class="va">site</span>, iter <span class="op">=</span> <span class="fl">600</span>, record <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">600</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the results</span></span>
<span><span class="va">walk</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span>xy <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="va">layer</span>, <span class="va">value</span>, <span class="op">-</span><span class="va">x</span>, <span class="op">-</span><span class="va">y</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">layer</span>, <span class="st">" ("</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="va">layer</span>, <span class="st">"iter"</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="../reference/iter_length.html">iter_length</a></span><span class="op">(</span><span class="va">walk</span><span class="op">)</span><span class="op">)</span>, <span class="st">" hours"</span>, <span class="st">")"</span><span class="op">)</span>,</span>
<span>             layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">layer</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">layer</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"point"</span>, x <span class="op">=</span> <span class="va">site</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">site</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">layer</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"sqrt"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"mass"</span>, x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="windscape_files/figure-html/rw-1.png" width="95%"></p>
<p>The amount of simulated time represented by each iteration will vary
depending on the data; it is computed internally to maximize the ratio
of simulation time to computational processing time, and can be accessed
by calling <code><a href="../reference/iter_length.html">iter_length()</a></code> on the random walk output. In our
case, one iteration is 1.58 hours, so our full simulation represents 949
hours. (It only represents actual clock time if you use a conductance
value of <code>trans = 1</code> when creating the wind rose; otherwise,
it represents a relative measure of diffusion speed with less
interpretable units.)</p>
<p>Our simulation tracked the fleeting diffusion of the initial “pulse”
of particle mass, most of which will eventually leave the modeling
domain after enough iterations. Alternatively, we could have specified
<code>mode = "ratchet"</code> to run a propagating simulation in which
local particle mass never declines, continuing to transmit mass at the
cumulative maximum rate. This is equivalent to simulating continued
input of the initial particle mass at every iteration. Compared to the
“pulse” mode, this option may be more useful in modeling a biological
process where particles are continually released or can propagate
locally after colonization.</p>
</div>
</div>
<div class="section level2">
<h2 id="testing-statistical-relationships">Testing statistical relationships<a class="anchor" aria-label="anchor" href="#testing-statistical-relationships"></a>
</h2>
<p>The <code>windscape</code> library also provides a set of utilities
for testing statistical relationships between wind connectivity results
and data representing other ecological features of the same landscape.
These functions are intended for working with pairwise wind connectivity
estimates among a set of sites, such as the <code>wind_time</code> data
we generated in the “least cost path” example above.</p>
<p>We’ll work with those results here. Let’s imagine the ten sites
represent the locations of populations where landscape genetic data were
sampled. There are various measures of landscape genetic relationships
among sites we could calculate using other software, including estimates
of directional gene flow, genetic differentiation, and genetic
diversity. Let’s look at how to test relationships between wind travel
times and each of these genetic patterns.</p>
<p>Statistical significance is calculated based on the widely-used
partial Mantel test. The windscape library provides a
<code><a href="../reference/mantel_test.html">mantel_test()</a></code> function that allows distance matrices with
different upper and lower triangles, and allows multiple control
variables, a combination of features that is key for our purposes and
isn’t possible in Mantel test implementations in other R packages. The
<code><a href="../reference/pairwise_means.html">pairwise_means()</a></code> and <code><a href="../reference/pairwise_ratios.html">pairwise_ratios()</a></code>
functions refactor the data to help test different hypotheses.</p>
<p>In the example below, we’ll test how wind flow, wind speed, and wind
asymmetry relate to a hypothetical genetic data set (see <a href="https://doi.org/10.1073/pnas.2017317118" class="external-link">here</a> for details on
these hypotheses). Because the genetic data are generated randomly in
this example, the results are not significant. Here we’ll use geographic
distances as a control variable; in other cases, you might want to use
variables like environmental differences or non-wind dispersal
influences as controls.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># pairwise geographic distance between sites,</span></span>
<span><span class="co"># for use as a control variable in the partial Mantel tests</span></span>
<span><span class="va">distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/point_distance.html">point_distance</a></span><span class="op">(</span><span class="va">sites</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># test correlation between wind flow and gene flow, controlling for distance</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sites</span><span class="op">)</span></span>
<span><span class="va">gene_flow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, <span class="va">n</span><span class="op">)</span> <span class="co"># simulate random gene flow data</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mantel_test.html">mantel_test</a></span><span class="op">(</span><span class="va">wind_time</span>, <span class="va">gene_flow</span>, z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">distance</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># test correlation between bidirectional wind connectivity and genetic isolation,</span></span>
<span><span class="co"># controlling for distance</span></span>
<span><span class="va">gene_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, <span class="va">n</span><span class="op">)</span> <span class="co"># simulate random genetic differentiation data</span></span>
<span><span class="va">wind_conn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pairwise_means.html">pairwise_means</a></span><span class="op">(</span><span class="va">wind_time</span><span class="op">)</span> <span class="co"># convert to symmetric matrix</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mantel_test.html">mantel_test</a></span><span class="op">(</span><span class="va">wind_conn</span>, <span class="va">gene_dist</span>, z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">distance</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># test correlation between wind asymmetry and gene flow asymmetry</span></span>
<span><span class="co"># (no distance control is needed for a test of reciprocally symmetric matrices)</span></span>
<span><span class="va">wind_asym</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pairwise_ratios.html">pairwise_ratios</a></span><span class="op">(</span><span class="va">wind_time</span><span class="op">)</span> <span class="co"># convert to asymmetry matrix</span></span>
<span><span class="va">gene_asym</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pairwise_ratios.html">pairwise_ratios</a></span><span class="op">(</span><span class="va">gene_flow</span><span class="op">)</span> <span class="co"># convert to asymmetry matrix</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mantel_test.html">mantel_test</a></span><span class="op">(</span><span class="va">wind_asym</span>, <span class="va">gene_asym</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># test correlation between wind asymmetry and genetic diversity asymmetry</span></span>
<span><span class="va">diversity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="co"># simulated diversity for each population</span></span>
<span><span class="va">div_asym</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pairwise_ratios.html">pairwise_ratios</a></span><span class="op">(</span><span class="va">diversity</span><span class="op">)</span> <span class="co"># pairwise diversity ratios</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mantel_test.html">mantel_test</a></span><span class="op">(</span><span class="va">wind_asym</span>, <span class="va">div_asym</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 4</span></span>
<span><span class="co">#&gt;  $ stat    : num 0.093</span></span>
<span><span class="co">#&gt;  $ quantile: num 0.647</span></span>
<span><span class="co">#&gt;  $ p.value : num 0.707</span></span>
<span><span class="co">#&gt;  $ perm    : num [1:999] -0.187 -0.138 0.393 -0.19 -0.224 ...</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Kling.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
